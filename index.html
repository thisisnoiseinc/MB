<!DOCTYPE html>
<html>
<head>
  <title>ESP32S2 Bootloader Mode 3.0</title>
  <script src="https://cdn.jsdelivr.net/npm/esptool-js@0.3.0/lib/index.min.js"></script>
</head>
<body>
  <button id="connectButton">Connect to ESP32S2</button>

  <script>
const baudrates = 115200;
const connectButton = document.getElementById("connectButton") as HTMLButtonElement;

import { ESPLoader } from "./esploader";
import { Transport } from "./webserial";

    connectButton.onclick = async () => {
  if (device === null) {
    device = await navigator.serial.requestPort({});
    transport = new Transport(device);
  }

  try {
    const flashOptions = {
      transport,
      baudrate: parseInt(baudrates.value),
      terminal: espLoaderTerminal,
    } as LoaderOptions;
    esploader = new ESPLoader(flashOptions);

    chip = await esploader.main_fn();

    // Temporarily broken
    // await esploader.flash_id();
  } catch (e) {
    console.error(e);
    term.writeln(`Error: ${e.message}`);
  }

  console.log("Settings done for :" + chip);
  lblBaudrate.style.display = "none";
  lblConnTo.innerHTML = "Connected to device: " + chip;
  lblConnTo.style.display = "block";
  baudrates.style.display = "none";
  connectButton.style.display = "none";
  disconnectButton.style.display = "initial";
  eraseButton.style.display = "initial";
  filesDiv.style.display = "initial";
  consoleDiv.style.display = "none";
};

  </script>
</body>
</html>
