<!DOCTYPE html>
<html>
<link rel="stylesheet" href="../MB/style.css" />
<link rel="icon" href="https://cdn.shopify.com/s/files/1/0521/7284/9345/files/Favicon_d7d0f79f-bd39-4262-aea3-f76f66f726a1.png?v=1664544047" />
<title>MIDI BLASTER Updater</title>
<body>
    <h1 style= "font-family: Avenir; color: white;">MIDI BLASTER UPDATER ðŸ”§</h1>
    <p style= "font-family: Avenir; color: #79DA75;">Latest Version: 1.0.0</p>
    <p style= "font-family: Avenir; color: white;">1. Hold Button 1 on MIDI BLASTER during start-up</p>
    <p style= "font-family: Avenir; color: white;">2. Press "Install" below ðŸ‘‡</p>
    <script type="module" src="https://unpkg.com/esp-web-tools@3.4.2/dist/web/install-button.js?module"></script>
    <script src="https://unpkg.com/esptool-js/lib/index.js?module"></script>
    <esp-web-install-button manifest="test/manifest.json"></esp-web-install-button>

    <input class="btn btn-info btn-sm" type="button" id="connectButton" value="Connect" onclick="connectButton()" />
    
<script>
   const connectButton = document.getElementById("connectButton") as HTMLButtonElement;
   let device = null;
   let transport: Transport;
   let chip: string = null;
   let esploader: ESPLoader;

connectButton.onclick = async () => {
  if (device === null) {
    device = await navigator.serial.requestPort({});
    transport = new Transport(device);
  }

  try {
    const flashOptions = {
      transport,
      baudrate: parseInt(baudrates.value),
      terminal: espLoaderTerminal,
    } as LoaderOptions;
    esploader = new ESPLoader(flashOptions);

    chip = await esploader.main_fn();

    // Temporarily broken
    // await esploader.flash_id();
  } catch (e) {
    console.error(e);
    term.writeln(`Error: ${e.message}`);
  }
    }
</script>
    
    <style>
  :root {
    --esp-tools-button-color: #B51F99;
    --esp-tools-button-text-color: white;
  }
</style>
</body>
</html>
