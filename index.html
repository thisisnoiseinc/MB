<!DOCTYPE html>
<html>
<head>
  <title>ESP32S2 Bootloader Mode</title>
</head>
<body>
  <button id="connectBtn">Connect to ESP32S2</button>
  <button id="disconnectBtn">Disconnect</button>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let port;
      const connectBtn = document.getElementById("connectBtn");
      const disconnectBtn = document.getElementById("disconnectBtn");

      // Function to log messages to the console
      function logToConsole(message) {
        console.log(message);
      }

      // Function to put the ESP32S2 into bootloader mode
      async function enterBootloaderMode() {
        try {
          port = await navigator.serial.requestPort({ filters: [] });
          await port.open({ baudRate: 115200 }); // Set the baud rate here

          // Toggle DTR and RTS signals to put ESP32S2 into bootloader mode
          await port.setSignals({ dataTerminalReady: false, requestToSend: true });
          await new Promise((resolve) => setTimeout(resolve, 200)); // Adjust the delay as needed
          await port.setSignals({ dataTerminalReady: true, requestToSend: false });

          logToConsole("ESP32S2 in bootloader mode.");
        } catch (err) {
          console.error("Error putting ESP32S2 into bootloader mode:", err);
        }
      }

      // Function to disconnect from the serial port
      async function disconnect() {
        if (port) {
          await port.close();
          logToConsole("Disconnected");
        }
      }

      // Event listener for the Connect button
      connectBtn.addEventListener("click", () => {
        enterBootloaderMode();
      });

      // Event listener for the Disconnect button
      disconnectBtn.addEventListener("click", () => {
        disconnect();
      });
    });
  </script>
</body>
</html>
